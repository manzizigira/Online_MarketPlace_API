<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Categories</title>
    <link th:href="@{/adminCSS/addCategoryCSS.css}" rel="stylesheet">
</head>
<body>

<!-- Top Navigation Bar -->
<div class="navbar">
    <div class="title-container">
        <div class="title" style="color: white; font-size: 20px; font-weight: bold; margin-left: 50px;">Category Management</div>
    </div>
</div>

<!-- Sidebar -->
<div id="sidebar" class="sidebar">
    <a th:href="@{/viewProductsPage}" style="color: white;">Products</a>
    <a th:href="@{/viewUserManagement}" style="color: white;">Users</a>
    <a th:href="@{/viewOrderManagement}" style="color: white;">Orders</a>
    <a th:href="@{/viewCategoryPage}" style="color: white;">Categories</a>

    <div class="spacer"></div>

    <!-- Logout button -->
    <a class="logout-btn" onclick="window.location.href='/viewLoginPage'">Logout</a>

</div>

<!-- Main Content Area -->
<div class="main-content">


    <!-- Table Actions (Buttons) -->
    <div class="table-actions" style="margin-left: 30px; margin-top: 20px;">
        <div class="button white" onclick="showAddPopup()" style="box-shadow: 1px 0px 2px; width: 190px;">Add Category</div>
    </div>


    <!-- Category Form (Popup) -->
    <div id="form-popup" class="popup-overlay">
        <div class="popup">
            <button class="close-btn" onclick="closePopup()">Ã—</button>
            <h2>Add Category</h2>
            <form th:action="@{/registerCategory}" method="post" th:object="${newCategory}">
                <label id="name">Category Name:</label>
                <input type="text" th:field="*{categoryName}" required />
                <button type="submit">Add Category</button>
            </form>
        </div>
    </div>

    <!-- Category List Table -->
    <div class="category-table">
        <h2>Category List</h2>
        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="category : ${categories}">
                    <td th:text="${category.categoryName}"></td>
                    <td>
                        <div class="btn btn-secondary"
                             style="box-shadow: 1px 0px 2px; width: 90px;"
                             th:attr="onclick='submitForm(' + ${category.id} + ')'" >
                            Update
                        </div>
                        <!-- Delete Button with data-id attribute to store the product ID -->
                        <div class="btn btn-warning"
                             style="box-shadow: 1px 0px 2px; width:90px"
                             th:attr="onclick='confirmDelete(' + ${category.id} + ')'">
                            Delete
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<form id="updateProductForm" action="/update-categories" method="POST" style="display:none;">
    <input type="hidden" name="id" id="categoryId">
</form>

<form id="deleteForm" action="/delete-category" method="POST" style="display:none;">
    <input type="hidden" name="id" id="deleteCategoryId">
</form>

<script>
    function showAddPopup() {
        document.getElementById("form-popup").style.display = "block";
    }

    function submitForm(categoryId) {
        console.log("Updating Category with ID:", categoryId);
        document.getElementById('categoryId').value = categoryId;
        document.getElementById('updateProductForm').submit();
    }

    function confirmDelete(categoryId) {

        // Set the product ID to the hidden input field in the form
        document.getElementById('deleteCategoryId').value = categoryId;

        // Submit the form to trigger the deletion
        document.getElementById('deleteForm').submit();
    }

    function closePopup() {
        document.getElementById('form-popup').style.display = 'none';
    }

</script>

</body>
</html>
